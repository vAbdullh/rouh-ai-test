<!DOCTYPE html>
<html lang="ar" dir="rtl">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Ø±ÙˆØ­ - Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø© Ø§Ù„Ø°ÙƒÙŠØ©</title>
    <script src="https://cdn.tailwindcss.com"></script>
  </head>
  <body
    class="h-screen w-screen bg-gradient-to-b from-white to-purple-100 flex flex-col font-sans"
  >
    <!-- Header -->
    <header class="py-4 text-center border-b border-gray-300 bg-white shadow">
      <div class="text-3xl">âœ¨</div>
      <h1 class="text-xl font-semibold text-gray-800 mt-1">
        Ø±ÙˆØ­ - Ù…Ø³Ø§Ø¹Ø¯ØªÙƒ Ø§Ù„Ø°ÙƒÙŠØ©
      </h1>
    </header>

    <!-- User Info Form -->
    <div
      id="user-form"
      class="flex-1 flex flex-col items-center justify-center px-4 space-y-4"
    >
      <input
        type="text"
        id="name"
        placeholder="Ø§Ù„Ø§Ø³Ù…"
        class="w-full max-w-md px-4 py-3 border rounded-md text-right"
      />
      <input
        type="number"
        id="age"
        placeholder="Ø§Ù„Ø¹Ù…Ø±"
        class="w-full max-w-md px-4 py-3 border rounded-md text-right"
      />
      <input
        type="number"
        id="week"
        placeholder="Ø£Ø³Ø¨ÙˆØ¹ Ø§Ù„Ø­Ù…Ù„"
        class="w-full max-w-md px-4 py-3 border rounded-md text-right"
      />
      <button
        onclick="startChat()"
        class="bg-purple-600 text-white px-6 py-2 rounded hover:bg-purple-700"
      >
        Ø§Ø¨Ø¯Ø¦ÙŠ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©
      </button>
    </div>

    <!-- Chat Section -->
    <main
      id="chat-section"
      class="flex-1 flex flex-col hidden container mx-auto"
    >
      <div
        id="chat-messages"
        class="flex-1 overflow-y-auto px-4 py-4 space-y-4 pb-32"
      >
        <!-- Messages go here -->
      </div>

      <!-- Chat Input -->
      <div class="fixed bottom-0 left-0 right-0 bg-white border-t px-4 py-3">
        <div class="max-w-3xl mx-auto flex items-center gap-2">
          <input
            type="text"
            id="user-input"
            placeholder="Ø§ÙƒØªØ¨ÙŠ Ø±Ø³Ø§Ù„ØªÙƒ Ù‡Ù†Ø§..."
            class="flex-1 px-4 py-3 border rounded-md text-right"
          />
          <button
            onclick="handleSend()"
            class="bg-purple-600 text-white px-4 py-2 rounded hover:bg-purple-700"
          >
            Ø¥Ø±Ø³Ø§Ù„
          </button>
        </div>
      </div>
    </main>

    <!-- CSS -->
    <style>
      .typing-indicator {
        display: inline-block;
        position: relative;
        width: 60px;
        height: 30px;
      }
      .typing-dot {
        position: absolute;
        width: 8px;
        height: 8px;
        border-radius: 50%;
        background-color: #8b5cf6;
        animation: typing-animation 1.4s infinite ease-in-out;
      }
      .typing-dot:nth-child(1) {
        left: 8px;
        animation-delay: 0s;
      }
      .typing-dot:nth-child(2) {
        left: 24px;
        animation-delay: 0.2s;
      }
      .typing-dot:nth-child(3) {
        left: 40px;
        animation-delay: 0.4s;
      }
      @keyframes typing-animation {
        0%, 60%, 100% { transform: translateY(0); }
        30% { transform: translateY(-8px); }
      }
    </style>

    <!-- JavaScript -->
    <script>
      const DEEPSEEK_API_KEY = "sk-af24e259f4424f988b509644ebb7b7e7"; // ğŸ›‘ Replace with your actual key
      let conversationHistory = [];
      let user = { name: "", age: "", week: "" };

      function getInitialPrompt(name, age, week) {
        return `Ø£Ù†Øª "Ø±ÙˆØ­"ØŒ Ù…Ø³Ø§Ø¹Ø¯Ø© Ø°ÙƒÙŠØ© Ù…ØªØ®ØµØµØ© ÙÙŠ Ø¯Ø¹Ù… Ø§Ù„Ù†Ø³Ø§Ø¡ Ø®Ù„Ø§Ù„ Ø±Ø­Ù„Ø© Ø§Ù„Ø­Ù…Ù„ ÙˆÙ…Ø§ Ø¨Ø¹Ø¯ Ø§Ù„ÙˆÙ„Ø§Ø¯Ø©. 
- ØªØ­Ø¯Ø«ÙŠ Ø¨Ù„ØºØ© Ø¨Ø³ÙŠØ·Ø© ÙˆØ¯Ø§Ø¹Ù…Ø©
- Ù‚Ø¯Ù…ÙŠ Ø¥Ø¬Ø§Ø¨Ø§Øª Ù‚ØµÙŠØ±Ø© ÙˆÙˆØ§Ø¶Ø­Ø©
- Ø±ÙƒØ²ÙŠ Ø¹Ù„Ù‰ Ø§Ù„Ø¬ÙˆØ§Ù†Ø¨ Ø§Ù„Ù†ÙØ³ÙŠØ© ÙˆØ§Ù„Ø¬Ø³Ø¯ÙŠØ©
- Ø§Ø³ØªØ®Ø¯Ù…ÙŠ Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ØªØ§Ù„ÙŠØ© Ø¹Ù† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…Ø©:
  Ø§Ù„Ø§Ø³Ù…: ${name}
  Ø§Ù„Ø¹Ù…Ø±: ${age}
  Ø£Ø³Ø¨ÙˆØ¹ Ø§Ù„Ø­Ù…Ù„: ${week}

Ù…Ø¬Ø§Ù„Ø§Øª Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø©:
1. Ù…ØªØ§Ø¨Ø¹Ø© ØªØ·ÙˆØ± Ø§Ù„Ø­Ù…Ù„ (Ø£Ø¹Ø±Ø§Ø¶ØŒ ØªØºÙŠØ±Ø§Øª Ø¬Ø³Ø¯ÙŠØ©ØŒ Ù†Ù…Ùˆ Ø§Ù„Ø¬Ù†ÙŠÙ†)
2. Ø§Ù„Ø¯Ø¹Ù… Ø§Ù„Ù†ÙØ³ÙŠ (Ø§Ù„ØªÙ‚Ù„Ø¨Ø§Øª Ø§Ù„Ù…Ø²Ø§Ø¬ÙŠØ©ØŒ Ø§Ù„Ù‚Ù„Ù‚ØŒ Ø§ÙƒØªØ¦Ø§Ø¨ Ù…Ø§ Ø¨Ø¹Ø¯ Ø§Ù„ÙˆÙ„Ø§Ø¯Ø©)
3. Ù†ØµØ§Ø¦Ø­ Ø±Ø¹Ø§ÙŠØ© Ø§Ù„Ø·ÙÙ„ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
4. ØªØ°ÙƒÙŠØ± Ø¨Ø§Ù„Ø±Ø¹Ø§ÙŠØ© Ø§Ù„Ø·Ø¨ÙŠØ© Ø¹Ù†Ø¯ Ø§Ù„Ø­Ø§Ø¬Ø©`;
      }

      function getFollowupPrompt(name, age, week, message) {
        return `Ø£Ù†Øª "Ø±ÙˆØ­" Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø© Ø§Ù„Ø°ÙƒÙŠØ© Ù„Ù„Ø­Ù…Ù„. Ø§Ø³ØªÙ…Ø±ÙŠ ÙÙŠ Ø£Ø³Ù„ÙˆØ¨Ùƒ Ø§Ù„Ø¨Ø³ÙŠØ· ÙˆØ§Ù„Ø¯Ø§Ø¹Ù….

Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…Ø©:
- Ø§Ù„Ø§Ø³Ù…: ${name}
- Ø§Ù„Ø¹Ù…Ø±: ${age}
- Ø£Ø³Ø¨ÙˆØ¹ Ø§Ù„Ø­Ù…Ù„: ${week}

Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…Ø©:
"${message}"`;
      }

      function startChat() {
        user.name = document.getElementById("name").value.trim();
        user.age = document.getElementById("age").value.trim();
        user.week = document.getElementById("week").value.trim();

        if (!user.name || !user.age || !user.week) {
          alert("ÙŠØ±Ø¬Ù‰ ØªØ¹Ø¨Ø¦Ø© Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„");
          return;
        }

        document.getElementById("user-form").classList.add("hidden");
        document.getElementById("chat-section").classList.remove("hidden");

        addMessage("assistant", "Ù…Ø±Ø­Ø¨Ø§Ù‹ØŒ Ø£Ù†Ø§ Ø±ÙˆØ­! ÙƒÙŠÙ Ø£Ø³ØªØ·ÙŠØ¹ Ù…Ø³Ø§Ø¹Ø¯ØªÙƒ Ø§Ù„ÙŠÙˆÙ…ØŸ");
      }

      function addMessage(role, content) {
        const chatContainer = document.getElementById("chat-messages");
        const msg = document.createElement("div");
        msg.className = `max-w-md mx-4 my-2 ${
          role === "user" ? "ml-auto" : "mr-auto"
        }`;
        msg.innerHTML = `
        <div class="${
          role === "user"
            ? "bg-blue-50 text-blue-900 border border-blue-200"
            : "bg-purple-50 text-purple-900 border border-purple-200"
        } p-4 rounded-lg shadow-sm">${content}</div>
      `;
        chatContainer.appendChild(msg);
        chatContainer.scrollTop = chatContainer.scrollHeight;
      }

      async function handleSend() {
        const input = document.getElementById("user-input");
        const text = input.value.trim();
        if (!text) return;

        input.value = "";
        addMessage("user", text);

        // Show typing indicator
        const typingIndicator = document.createElement("div");
        typingIndicator.className = "max-w-md mr-auto my-2";
        typingIndicator.innerHTML = `
          <div class="bg-purple-50 p-4 rounded-lg">
            <div class="typing-indicator">
              <div class="typing-dot"></div>
              <div class="typing-dot"></div>
              <div class="typing-dot"></div>
            </div>
          </div>
        `;
        document.getElementById("chat-messages").appendChild(typingIndicator);
        document.getElementById("chat-messages").scrollTop = document.getElementById("chat-messages").scrollHeight;

        const messages = [];

        if (conversationHistory.length === 0) {
          messages.push({
            role: "system",
            content: getInitialPrompt(user.name, user.age, user.week),
          });
        } else {
          messages.push(...conversationHistory);
        }

        messages.push({
          role: "user",
          content: getFollowupPrompt(user.name, user.age, user.week, text),
        });

        try {
          const res = await fetch(
            "https://api.deepseek.com/v1/chat/completions",
            {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
                Authorization: `Bearer ${DEEPSEEK_API_KEY}`,
              },
              body: JSON.stringify({
                model: "deepseek-chat",
                messages,
              }),
            }
          );

          const data = await res.json();
          const aiResponse =
            data.choices?.[0]?.message?.content || "Ù„Ù… Ø£ØªÙ…ÙƒÙ† Ù…Ù† Ø§Ù„Ø±Ø¯ Ø­Ø§Ù„ÙŠØ§Ù‹.";
          conversationHistory = [
            ...messages,
            { role: "assistant", content: aiResponse },
          ].slice(-10);

          // Remove typing indicator before showing response
          document.getElementById("chat-messages").removeChild(typingIndicator);
          addMessage("assistant", aiResponse);
        } catch (err) {
          console.error(err);
          document.getElementById("chat-messages").removeChild(typingIndicator);
          addMessage("assistant", "Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹ Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ.");
        }
      }
    </script>
  </body>
</html>
